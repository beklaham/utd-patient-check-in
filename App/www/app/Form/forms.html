<!DOCTYPE>
<html>

<head>
  <title>Forms</title>
</head>

<body>

  <ion-view>
  
    <div class="bar bar-header bar-positive" ng-controller="InsideCtrl">
      <h1 class="form-title">Patient Forms</h1>
      <button class="signout" ng-click="logout()">
        Sign Out
      </button>
    </div>

    <ion-content class="has-header" scroll="false">
      <div ng-controller="FormCtrl as form">
        <md-content layout-padding="" ng-hide="showForm" class = "questionnaire-border">
          <md-content layout-padding class = "questionnaire-list-layout">
            <ul>
              <li ng-repeat="quest in QuestionnaireList" class="nth-color">
                <md-list>
                <div ng-click="goToForm(quest.RelSurveyPatientId)">
                  <md-list-item class="secondary-button-padding" >
                    <p class="q-title">{{quest.QuestionnaireName}}</p>
                    <md-button class="incomplete-button" ng-if="!quest.IsComplete" >Incomplete</md-button>
                    <md-button class="complete-button" ng-if="quest.IsComplete" > Completed Form</md-button>
                  </md-list-item>
                  <md-list-item >
                    <p class="completion-label">% Complete:</p>
                    <md-progress-linear class="progress-bar-format md-primary md-hue-1" md-mode="determinate" value="{{quest.PercentComplete}}"></md-progress-linear>
                  </md-list-item>
                  </div>
                </md-list>
              </li>
            </ul>
          </md-content>
        </md-content>

        <md-content ng-hide="!showForm" class = "questionnaire-border" >
          <md-progress-circular class="md-primary md-hue-2" ng-hide="qLoaded" md-mode="indeterminate" md-diameter="715">Loading...</md-progress-circular>
          <button ng-show="qLoaded" ng-click="clear()" class = "close-button">X</button>
          <li ng-repeat="quest in QuestionnaireList">
            <ul><li ng-repeat="sects in questionnaire.Questionnaire.Sections">
              {{currentSectionId=sects.SurveySectionId;""}}
              <div ng-show="showForm && quest.RelSurveyPatientId == questionnaireId && sectionIndex == $index">

                <div layout="row" flex>
                  <md-content layout-padding class = "questionnaire-layout">
                    <md-subheader class="questionnaire-header">{{sects.SurveySectionName}}</md-subheader>
                        <ul><li>
                          <ul ng-repeat="q in sects.Questions">
                            <p></p>
                            <!-- extra space between questions -->
                            <div ng-if="!q.QuestionOptional && q.SurveyControlTypeName != 'TIMEFRAME'">

                              <p><b> {{q.SurveyQuestionLabel}}</b></p>
                              
                              <div ng-if="q.SurveyControlTypeName == 'RADIOBUTTON'">
                                <md-radio-group ng-required="true" layout="row" layout-align="start center" ng-model="q.SelectedAnswerId" class="md-accent" layout-wrap>
                                  <md-radio-button ng-repeat="answer in q.Answers" ng-value="answer.SurveyAnswerId">
                                    {{answer.SurveyAnswerLabel}}
                                    <div ng-if="q.SelectedAnswerId == answer.SurveyAnswerId">
                                      {{answer.SelectedAnswer = true;""}}
                                      {{q.SelectedAnswerText = answer.SurveyAnswerLabel;""}}
                                    </div>
                                    <div ng-if="q.SelectedAnswerId != answer.SurveyAnswerId">
                                      {{answer.SelectedAnswer = false;""}}
                                    </div>
                                    <br/>
                                  </md-radio-button>
                                </md-radio-group>
                              </div>

                              <div ng-if="q.SurveyControlTypeName == 'TEXT'">
                                <!-- Code for Textbox goes here-->
                                <li><ul><li><ul ng-repeat="answers in q.Answers">
                                 <md-input-container class="md-block">
                                    <label> {{answers.SurveyAnswerLabel}}</label>
                                    <textarea ng-model="answers.SurveyResponseAnswerText" name="q.SurveyQuestionId"></textarea>
                                    <div ng-if="answers.SurveyResponseAnswerText.length > 0">
                                      {{q.SelectedAnswerText = answers.SurveyResponseAnswerText;""}}
                                      {{answers.SelectedAnswer = true;""}}
                                    </div>
                                  </md-input-container>
                                </ul></li></ul></li>
                              </div>

                              <!-- Timeframe code would go here
                              <div ng-if="q.SurveyControlTypeName == 'TIMEFRAME'">
                                <li><ul><li>
                                  <ul ng-repeat="answers in q.Answers">
                                  </ul>
                                </li></ul></li>
                              </div> -->

                              <div ng-if="q.SurveyControlTypeName == 'CHECKBOX'">
                                <!-- Code for checkbox goes here-->
                                <div layout="row" layout-wrap layout-padding flex>
                                  <div flex="50" ng-repeat="answers in q.Answers">
                                    <md-checkbox ng-model="answers.SelectedAnswer">
                                      {{answers.SurveyAnswerLabel}}
                                    </md-checkbox>
                                  </div>
                                </div>
                              </div>

                              <div ng-if="q.SurveyControlTypeName == 'NUMERIC'">
                                <md-radio-group  ng-required="true" layout="row" ng-model="q.SelectedAnswerId" class="md-accent">
                                  <md-radio-button  ng-repeat="answer in q.Answers" 
                                                    ng-value="answer.SurveyAnswerId" 
                                                    ng-style="{'display':'inline'}">
                                    {{answer.SurveyAnswerLabel}}
                                    <div ng-if="q.SelectedAnswerId == answer.SurveyAnswerId">
                                      {{answer.SelectedAnswer = true;""}}
                                      {{q.SelectedAnswerText = answer.SurveyAnswerLabel;""}}
                                    </div>
                                    <div ng-if="q.SelectedAnswerId != answer.SurveyAnswerId">
                                      {{answer.SelectedAnswer = false;""}}
                                    </div>
                                    <br/>
                                  </md-radio-button>
                                </md-radio-group>
                              </div>
                            </div>
                          </ul>
                        </li></ul>
                        <div class="position-bottom-right" layout="row" layout-align="end end">
                          <div ng-if = "$index != 0">
                            <md-button class="nav-button" ng-click="goToPrevious()">Previous Page</md-button>
                          </div>
                          <div ng-if = "getLen()-1 != $index">
                            <md-button class="nav-button" ng-click="goToNext()">Next Page</md-button>
                          </div>
                          <div ng-if = "getLen()-1 == $index">
                            <md-button class="review-button" ng-click="goToReview()">Review Answers</md-button>
                          </div>
                        </div>
                  </md-content>
                </div>
              </div>
            </li></ul>
          </li>
        </md-content>
      </div>
    </ion-content>
  </ion-view>
</body>

</html>
    
